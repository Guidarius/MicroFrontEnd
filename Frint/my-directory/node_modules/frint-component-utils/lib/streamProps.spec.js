'use strict';

var _chai = require('chai');

var _of = require('rxjs/observable/of');

var _last = require('rxjs/operator/last');

var _streamProps = require('./streamProps');

var _streamProps2 = _interopRequireDefault(_streamProps);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint-disable import/no-extraneous-dependencies, func-names */
/* global describe, it */
describe('frint-react â€º streamProps', function () {
  it('is a function', function () {
    (0, _chai.expect)(_streamProps2.default).to.be.a('function');
  });

  it('streams with default object', function (done) {
    var streamer = (0, _streamProps2.default)({
      key: 'value'
    });

    streamer.get$().subscribe(function (props) {
      (0, _chai.expect)(props).to.deep.equal({
        key: 'value'
      });

      done();
    });
  });

  it('streams plain object, by merging with default', function (done) {
    var _context;

    var streamer = (0, _streamProps2.default)({
      key: 'value',
      key2: 'value2'
    });

    streamer.set({
      key2: 'value2 overridden',
      key3: 'value3'
    });

    (_context = streamer.get$(), _last.last).call(_context).subscribe(function (props) {
      (0, _chai.expect)(props).to.deep.equal({
        key: 'value',
        key2: 'value2 overridden',
        key3: 'value3'
      });

      done();
    });
  });

  it('streams key/value pairs, by merging with default', function (done) {
    var _context2;

    var streamer = (0, _streamProps2.default)({
      key: 'value'
    });

    streamer.set('key2', 'value2 overridden');
    streamer.set('key3', 'value3');

    (_context2 = streamer.get$(), _last.last).call(_context2).subscribe(function (props) {
      (0, _chai.expect)(props).to.deep.equal({
        key: 'value',
        key2: 'value2 overridden',
        key3: 'value3'
      });

      done();
    });
  });

  it('streams multiple observables with mappings, by merging with default', function (done) {
    var _context3;

    var streamer = (0, _streamProps2.default)({
      key: 'value'
    });

    var names$ = (0, _of.of)('Fahad', 'Ricardo', 'Mark', 'Jean', 'Alex' // last one wins
    );
    var numbers$ = (0, _of.of)(1, 2, 3 // last one wins
    );

    streamer.set(names$, function (name) {
      return { name: name };
    } // final plain object
    );

    streamer.set(numbers$, function (number) {
      return number * 2;
    }, // direct mapped values
    function (number) {
      return (0, _of.of)(number);
    }, // even mapped observables
    function (number) {
      return { number: number };
    } // final plain object
    );

    (_context3 = streamer.get$(), _last.last).call(_context3).subscribe(function (props) {
      (0, _chai.expect)(props).to.deep.equal({
        key: 'value',
        name: 'Alex',
        number: 6 // 3 * 2
      });

      done();
    });
  });

  it('steams dispatchable actions against store', function (done) {
    var _context4;

    var streamer = (0, _streamProps2.default)();
    var dispatchedPayload = void 0;

    var fakeStore = {
      dispatch: function dispatch(payload) {
        dispatchedPayload = payload;
      }
    };

    function myActionCreator(value) {
      return {
        type: 'MY_ACTION_TYPE',
        value: value
      };
    }

    streamer.setDispatch({ myAction: myActionCreator }, fakeStore);

    (_context4 = streamer.get$(), _last.last).call(_context4).subscribe(function (props) {
      props.myAction('someValue');

      (0, _chai.expect)(dispatchedPayload).to.deep.equal({
        type: 'MY_ACTION_TYPE',
        value: 'someValue'
      });

      done();
    });
  });

  it('has no impact if unexpected values are set', function (done) {
    var streamer = (0, _streamProps2.default)({
      key: 'value'
    });

    streamer.set(function () {
      return 'blah';
    });

    streamer.get$().subscribe(function (props) {
      (0, _chai.expect)(props).to.deep.equal({
        key: 'value'
      });

      done();
    });
  });
});